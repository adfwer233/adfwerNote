---
    title: "存储管理"
---

## 单道程序存储管理

内存分为两个区域：系统区和用户区，每次把一个应用程序塞到用户区内存里，以来共享内存。当它运行结束后，操作系统装入一个新的程序把它覆盖。

- 优点：简单、开销小，易于管理，适合于单用户单任务的情形
- 缺点
    - 每次只能运行一个程序
    - 内存资源的使用效率不高
    - 应用程序的 bug 会破坏 OS
    - 地址空间有限

### 如何实现多道存储管理

也就是说在内存中同时有多个进程运行。

- 需要考虑的问题
    - 


## 分区存储管理

内存分为两大区域：系统区和用户区，用户区又划分为若干分区，一个进程占用一个分区。

- 适合多道程序系统和分时系统，支持多个程序并发执行

### 固定分区存储管理

各个用户分区的个数、位置和大小确定，就固定不变。

- 分区的大小是否相等？
    - 程序大小不同，则进程占用空间不同
    - 多个小分区，适量中等分区，少量大分区
- 进程个数多于分区个数？
    - 增加一个输入队列

#### 如何实现？

- 数据结构：设置内存分配表
- 内存分配：先放入输入队列，然后采用最先匹配法，最佳匹配法等算法
- 内存回收：简单


### 可变分区的实现

**如何实现可变分区的存储管理技术？**

#### 分区链表

系统维护一个有序的分区链表，跟踪记录每个内存分区的情况，包括该分区的状态、起始地址、长度等信息。

#### 分区分配算法

当一个新进程到来时，需要为它寻找分配某个空闲分区，其大小必须大于或等于该进程的要求。

- 最先匹配法
    - 从分区链表的头结点开始向后找，知道找到一个结点长度大于新进程对内存大小的要求的结点
- 下次匹配法
    - 和最先匹配法类似，每找到一个合适的结点时，就把当前的位置记录下来，下次从这个位置开始继续往下找
- 最佳匹配法
    - 找到与新进程对内存大小要求最接近的空闲分区之中。
    - 缺点：分割后剩余的空闲分区将会很小，甚至无法使用
- 最坏匹配法
    - 将最大的空闲区切一部分分给请求者

#### 分区回收算法

当一个进程运行结束，释放它所占用的分区后，需要将相邻的几个空闲分区合并为一个大的空闲分区

### 存储管理案例

### 内存中的程序执行

进程的地址空间，**内存布局**是什么样的？

- 全局变量：固定地址，其它源文件可见
- 静态全局变量：固定地址，但只在本文件中可见
- 函数参数：位于栈帧之中，动态创建，动态释放
- 静态局部变量：固定地址，只在本函数中可见
- 普通局部变量：位于栈帧中，只在本函数可见
- 动态申请的内存：位于堆中




## 页式和段式存储管理

## 虚拟存储技术

## Windows 存储管理

## Linux 存储管理